{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { useQuery, useQueryClient } from 'react-query';\nimport { useResourceContext } from '../core';\nimport { useDataProvider } from '../dataProvider';\nimport { useStore } from '../store';\nimport { SORT_ASC } from './list';\nimport { useRecordContext } from './record';\nimport { useCreatePath } from '../routing';\n/**\n * A hook used to fetch the previous and next record identifiers for a given record and resource.\n *\n * It fetches the list of records according to the filters\n * and the sort order configured in the list, and merges\n * the filters and the sorting order passed as props.\n *\n * usePrevNextController can be used anywhere a record context is provided\n * (often inside a `<Show>` or `<Edit>` component).\n *\n * @example <caption>Simple usage</caption>\n *\n * import { usePrevNextControllerProps } from 'ra-core';\n * const {\n *         hasPrev,\n *         hasNext,\n *         prevPath,\n *         nextPath,\n *         index,\n *         total,\n *         error,\n *         isLoading,\n *     } = usePrevNextController(props);\n *\n * @example <caption>Custom PrevNextButton</caption>\n *\n * import { UsePrevNextControllerProps, useTranslate } from 'ra-core';\n * import { NavigateBefore, NavigateNext } from '@mui/icons-material';\n * import ErrorIcon from '@mui/icons-material/Error';\n * import { Link } from 'react-router-dom';\n * import { CircularProgress, IconButton } from '@mui/material';\n *\n * const MyPrevNextButtons = props => {\n *     const {\n *         hasPrev,\n *         hasNext,\n *         nextPath,\n *         prevPath,\n *         index,\n *         total,\n *         error,\n *         isLoading,\n *     } = usePrevNextController(props);\n *\n *     const translate = useTranslate();\n *\n *     if (isLoading) {\n *         return <CircularProgress size={14} />;\n *     }\n *\n *     if (error) {\n *         return (\n *             <ErrorIcon\n *                 color=\"error\"\n *                 fontSize=\"small\"\n *                 titleAccess=\"error\"\n *                 aria-errormessage={error.message}\n *             />\n *         );\n *     }\n *\n *     return (\n *         <ul>\n *             <li>\n *                 <IconButton\n *                     component={hasPrev ? Link : undefined}\n *                     to={navigateToPrev}\n *                     aria-label={translate('ra.navigation.previous')}\n *                     disabled={!hasPrev}\n *                 >\n *                     <NavigateBefore />\n *                 </IconButton>\n *             </li>\n *             {typeof index === 'number' && (\n *                 <li>\n *                     {index + 1} / {total}\n *                 </li>\n *             )}\n *             <li>\n *                 <IconButton\n *                     component={hasNext ? Link : undefined}\n *                     to={navigateToNext}\n *                     aria-label={translate('ra.navigation.next')}\n *                     disabled={!hasNext}\n *                 >\n *                     <NavigateNext />\n *                 </IconButton>\n *             </li>\n *         </ul>\n *     );\n * };\n */\nexport var usePrevNextController = function (props) {\n  var _a, _b;\n  var _c = props.linkType,\n    linkType = _c === void 0 ? 'edit' : _c,\n    storeKey = props.storeKey,\n    _d = props.limit,\n    limit = _d === void 0 ? 1000 : _d,\n    _e = props.sort,\n    initialSort = _e === void 0 ? {\n      field: 'id',\n      order: SORT_ASC\n    } : _e,\n    _f = props.filter,\n    permanentFilter = _f === void 0 ? {} : _f,\n    _g = props.filterDefaultValues,\n    filterDefaultValues = _g === void 0 ? {} : _g,\n    _h = props.queryOptions,\n    queryOptions = _h === void 0 ? {\n      staleTime: 5 * 60 * 1000\n    } : _h;\n  var record = useRecordContext(props);\n  var resource = useResourceContext(props);\n  var createPath = useCreatePath();\n  if (!resource) {\n    throw new Error(\"<useNextPrevController> was called outside of a ResourceContext and without a resource prop. You must set the resource prop.\");\n  }\n  var storedParams = useStore(storeKey || \"\".concat(resource, \".listParams\"), {\n    filter: filterDefaultValues,\n    order: initialSort.order,\n    sort: initialSort.field,\n    page: 1,\n    perPage: 10\n  })[0];\n  var dataProvider = useDataProvider();\n  var queryClient = useQueryClient();\n  var pagination = {\n    page: 1,\n    perPage: limit\n  };\n  var sort = {\n    field: storedParams.sort,\n    order: storedParams.order\n  };\n  var filter = __assign(__assign({}, storedParams.filter), permanentFilter);\n  var meta = queryOptions.meta,\n    otherQueryOptions = __rest(queryOptions, [\"meta\"]);\n  var params = {\n    pagination: pagination,\n    sort: sort,\n    filter: filter,\n    meta: meta\n  };\n  // try to use data from the cache first\n  var queryData = queryClient.getQueryData([resource, 'getList', __assign(__assign({}, params), {\n    pagination: {\n      page: storedParams.page,\n      perPage: storedParams.perPage\n    }\n  })]);\n  var recordIndexInQueryData = (_a = queryData === null || queryData === void 0 ? void 0 : queryData.data) === null || _a === void 0 ? void 0 : _a.findIndex(function (r) {\n    return r.id === (record === null || record === void 0 ? void 0 : record.id);\n  });\n  var isRecordIndexFirstInNonFirstPage = recordIndexInQueryData === 0 && storedParams.page > 1;\n  var isRecordIndexLastInNonLastPage = recordIndexInQueryData === ((_b = queryData === null || queryData === void 0 ? void 0 : queryData.data) === null || _b === void 0 ? void 0 : _b.length) - 1 && storedParams.page < (queryData === null || queryData === void 0 ? void 0 : queryData.total) / storedParams.perPage;\n  var canUseCacheData = record && (queryData === null || queryData === void 0 ? void 0 : queryData.data) && recordIndexInQueryData !== -1 && !isRecordIndexFirstInNonFirstPage && !isRecordIndexLastInNonLastPage;\n  // If the previous and next ids are not in the cache, fetch the entire list.\n  // This is necessary e.g. when coming directly to a detail page,\n  // without displaying the list first\n  var _j = useQuery([resource, 'getList', params], function () {\n      return dataProvider.getList(resource, params);\n    }, __assign({\n      enabled: !canUseCacheData\n    }, otherQueryOptions)),\n    data = _j.data,\n    error = _j.error,\n    isLoading = _j.isLoading;\n  var finalData = canUseCacheData ? queryData.data : (data === null || data === void 0 ? void 0 : data.data) || [];\n  if (!record || isLoading) return {\n    isLoading: true\n  };\n  var ids = finalData.map(function (record) {\n    return record.id;\n  });\n  var index = ids.indexOf(record.id);\n  var previousId = typeof ids[index - 1] !== 'undefined' ? ids[index - 1] : null; // could be 0\n  var nextId = index !== -1 && index < ids.length - 1 ? ids[index + 1] : null;\n  return {\n    hasPrev: previousId !== null,\n    hasNext: nextId !== null,\n    prevPath: previousId !== null ? createPath({\n      type: linkType,\n      resource: resource,\n      id: previousId\n    }) : undefined,\n    nextPath: nextId !== null ? createPath({\n      type: linkType,\n      resource: resource,\n      id: nextId\n    }) : undefined,\n    index: index === -1 ? undefined : index,\n    total: canUseCacheData ? queryData === null || queryData === void 0 ? void 0 : queryData.total : data === null || data === void 0 ? void 0 : data.total,\n    error: error,\n    isLoading: isLoading\n  };\n};","map":{"version":3,"names":["useQuery","useQueryClient","useResourceContext","useDataProvider","useStore","SORT_ASC","useRecordContext","useCreatePath","usePrevNextController","props","_c","linkType","storeKey","_d","limit","_e","sort","initialSort","field","order","_f","filter","permanentFilter","_g","filterDefaultValues","_h","queryOptions","staleTime","record","resource","createPath","Error","storedParams","concat","page","perPage","dataProvider","queryClient","pagination","__assign","meta","otherQueryOptions","__rest","params","queryData","getQueryData","recordIndexInQueryData","_a","data","findIndex","r","id","isRecordIndexFirstInNonFirstPage","isRecordIndexLastInNonLastPage","_b","length","total","canUseCacheData","_j","getList","enabled","error","isLoading","finalData","ids","map","index","indexOf","previousId","nextId","hasPrev","hasNext","prevPath","type","undefined","nextPath"],"sources":["../../../src/controller/usePrevNextController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}