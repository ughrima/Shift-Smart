{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { useCallback, useEffect, useRef } from 'react';\nimport get from 'lodash/get';\nimport isEqual from 'lodash/isEqual';\nimport lodashDebounce from 'lodash/debounce';\nimport { useSafeSetState, removeEmpty } from '../../util';\nimport { useGetManyReference } from '../../dataProvider';\nimport { useNotify } from '../../notification';\nimport usePaginationState from '../usePaginationState';\nimport { useRecordSelection } from '../list/useRecordSelection';\nimport useSortState from '../useSortState';\nimport { useResourceContext } from '../../core';\nvar defaultFilter = {};\n/**\n * Fetch reference records, and return them when available\n *\n * Uses dataProvider.getManyReference() internally.\n *\n * @example // fetch the comments related to the current post\n * const { isLoading, data } = useReferenceManyFieldController({\n *     reference: 'comments',\n *     target: 'post_id',\n *     record: { id: 123, title: 'hello, world' },\n *     resource: 'posts',\n * });\n *\n * @param {Object} props\n * @param {string} props.reference The linked resource name. Required.\n * @param {string} props.target The target resource key. Required.\n * @param {Object} props.filter The filter applied on the recorded records list\n * @param {number} props.page the page number\n * @param {number} props.perPage the number of item per page\n * @param {Object} props.record The current resource record\n * @param {string} props.resource The current resource name\n * @param {Object} props.sort the sort to apply to the referenced records\n * @param {string} props.source The key of the linked resource identifier\n *\n * @returns {ListControllerResult} The reference many props\n */\nexport var useReferenceManyFieldController = function (props) {\n  var _a = props.debounce,\n    debounce = _a === void 0 ? 500 : _a,\n    reference = props.reference,\n    record = props.record,\n    target = props.target,\n    _b = props.filter,\n    filter = _b === void 0 ? defaultFilter : _b,\n    source = props.source,\n    initialPage = props.page,\n    initialPerPage = props.perPage,\n    _c = props.sort,\n    initialSort = _c === void 0 ? {\n      field: 'id',\n      order: 'DESC'\n    } : _c;\n  var notify = useNotify();\n  var resource = useResourceContext(props);\n  // pagination logic\n  var _d = usePaginationState({\n      page: initialPage,\n      perPage: initialPerPage\n    }),\n    page = _d.page,\n    setPage = _d.setPage,\n    perPage = _d.perPage,\n    setPerPage = _d.setPerPage;\n  // sort logic\n  var _e = useSortState(initialSort),\n    sort = _e.sort,\n    setSortState = _e.setSort;\n  var setSort = useCallback(function (sort) {\n    setSortState(sort);\n    setPage(1);\n  }, [setPage, setSortState]);\n  // selection logic\n  var _f = useRecordSelection(\"\".concat(resource, \".\").concat(record === null || record === void 0 ? void 0 : record.id, \".\").concat(reference)),\n    selectedIds = _f[0],\n    selectionModifiers = _f[1];\n  // filter logic\n  var filterRef = useRef(filter);\n  var _g = useSafeSetState({}),\n    displayedFilters = _g[0],\n    setDisplayedFilters = _g[1];\n  var _h = useSafeSetState(filter),\n    filterValues = _h[0],\n    setFilterValues = _h[1];\n  var hideFilter = useCallback(function (filterName) {\n    setDisplayedFilters(function (previousState) {\n      var _a = previousState,\n        _b = filterName,\n        _ = _a[_b],\n        newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n      return newState;\n    });\n    setFilterValues(function (previousState) {\n      var _a = previousState,\n        _b = filterName,\n        _ = _a[_b],\n        newState = __rest(_a, [typeof _b === \"symbol\" ? _b : _b + \"\"]);\n      return newState;\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  var showFilter = useCallback(function (filterName, defaultValue) {\n    setDisplayedFilters(function (previousState) {\n      var _a;\n      return __assign(__assign({}, previousState), (_a = {}, _a[filterName] = true, _a));\n    });\n    setFilterValues(function (previousState) {\n      var _a;\n      return __assign(__assign({}, previousState), (_a = {}, _a[filterName] = defaultValue, _a));\n    });\n  }, [setDisplayedFilters, setFilterValues]);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  var debouncedSetFilters = useCallback(lodashDebounce(function (filters, displayedFilters) {\n    setFilterValues(removeEmpty(filters));\n    setDisplayedFilters(displayedFilters);\n    setPage(1);\n  }, debounce), [setDisplayedFilters, setFilterValues, setPage]);\n  var setFilters = useCallback(function (filters, displayedFilters, debounce) {\n    if (debounce === void 0) {\n      debounce = true;\n    }\n    if (debounce) {\n      debouncedSetFilters(filters, displayedFilters);\n    } else {\n      setFilterValues(removeEmpty(filters));\n      setDisplayedFilters(displayedFilters);\n      setPage(1);\n    }\n  }, [setDisplayedFilters, setFilterValues, setPage, debouncedSetFilters]);\n  // handle filter prop change\n  useEffect(function () {\n    if (!isEqual(filter, filterRef.current)) {\n      filterRef.current = filter;\n      setFilterValues(filter);\n    }\n  });\n  var _j = useGetManyReference(reference, {\n      target: target,\n      id: get(record, source),\n      pagination: {\n        page: page,\n        perPage: perPage\n      },\n      sort: sort,\n      filter: filterValues\n    }, {\n      enabled: get(record, source) != null,\n      keepPreviousData: true,\n      onError: function (error) {\n        return notify(typeof error === 'string' ? error : error.message || 'ra.notification.http_error', {\n          type: 'error',\n          messageArgs: {\n            _: typeof error === 'string' ? error : error && error.message ? error.message : undefined\n          }\n        });\n      }\n    }),\n    data = _j.data,\n    total = _j.total,\n    pageInfo = _j.pageInfo,\n    error = _j.error,\n    isFetching = _j.isFetching,\n    isLoading = _j.isLoading,\n    refetch = _j.refetch;\n  return {\n    sort: sort,\n    data: data,\n    defaultTitle: null,\n    displayedFilters: displayedFilters,\n    error: error,\n    filterValues: filterValues,\n    hideFilter: hideFilter,\n    isFetching: isFetching,\n    isLoading: isLoading,\n    onSelect: selectionModifiers.select,\n    onToggleItem: selectionModifiers.toggle,\n    onUnselectItems: selectionModifiers.clearSelection,\n    page: page,\n    perPage: perPage,\n    refetch: refetch,\n    resource: reference,\n    selectedIds: selectedIds,\n    setFilters: setFilters,\n    setPage: setPage,\n    setPerPage: setPerPage,\n    hasNextPage: pageInfo ? pageInfo.hasNextPage : total != null ? page * perPage < total : undefined,\n    hasPreviousPage: pageInfo ? pageInfo.hasPreviousPage : page > 1,\n    setSort: setSort,\n    showFilter: showFilter,\n    total: total\n  };\n};","map":{"version":3,"names":["useCallback","useEffect","useRef","get","isEqual","lodashDebounce","useSafeSetState","removeEmpty","useGetManyReference","useNotify","usePaginationState","useRecordSelection","useSortState","useResourceContext","defaultFilter","useReferenceManyFieldController","props","_a","debounce","reference","record","target","_b","filter","source","initialPage","page","initialPerPage","perPage","_c","sort","initialSort","field","order","notify","resource","_d","setPage","setPerPage","_e","setSortState","setSort","_f","concat","id","selectedIds","selectionModifiers","filterRef","_g","displayedFilters","setDisplayedFilters","_h","filterValues","setFilterValues","hideFilter","filterName","previousState","_","newState","__rest","showFilter","defaultValue","__assign","debouncedSetFilters","filters","setFilters","current","_j","pagination","enabled","keepPreviousData","onError","error","message","type","messageArgs","undefined","data","total","pageInfo","isFetching","isLoading","refetch","defaultTitle","onSelect","select","onToggleItem","toggle","onUnselectItems","clearSelection","hasNextPage","hasPreviousPage"],"sources":["../../../../src/controller/field/useReferenceManyFieldController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}