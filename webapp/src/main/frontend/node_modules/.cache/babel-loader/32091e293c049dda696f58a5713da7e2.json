{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport HttpError from './HttpError';\nimport { stringify } from 'query-string';\nexport var createHeadersFromOptions = function (options) {\n  var requestHeaders = options.headers || new Headers({\n    Accept: 'application/json'\n  });\n  var hasBody = options && options.body;\n  var isContentTypeSet = requestHeaders.has('Content-Type');\n  var isGetMethod = !(options === null || options === void 0 ? void 0 : options.method) || (options === null || options === void 0 ? void 0 : options.method) === 'GET';\n  var isFormData = (options === null || options === void 0 ? void 0 : options.body) instanceof FormData;\n  var shouldSetContentType = hasBody && !isContentTypeSet && !isGetMethod && !isFormData;\n  if (shouldSetContentType) {\n    requestHeaders.set('Content-Type', 'application/json');\n  }\n  if (options.user && options.user.authenticated && options.user.token) {\n    requestHeaders.set('Authorization', options.user.token);\n  }\n  return requestHeaders;\n};\n/**\n * Utility function to make HTTP calls. It's similar to the HTML5 `fetch()`, except it handles JSON decoding and HTTP error codes automatically.\n *\n * @param url the URL to call\n * @param options the options to pass to the HTTP call\n * @param options.user the user object, used for the Authorization header\n * @param options.user.token the token to pass as the Authorization header\n * @param options.user.authenticated whether the user is authenticated or not (the Authorization header will be set only if this is true)\n * @param options.headers the headers to pass to the HTTP call\n *\n * @returns {Promise} the Promise for a response object containing the following properties:\n * - status: the HTTP status code\n * - headers: the HTTP headers\n * - body: the response body\n * - json: the response body parsed as JSON\n */\nexport var fetchJson = function (url, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  var requestHeaders = createHeadersFromOptions(options);\n  return fetch(url, __assign(__assign({}, options), {\n    headers: requestHeaders\n  })).then(function (response) {\n    return response.text().then(function (text) {\n      return {\n        status: response.status,\n        statusText: response.statusText,\n        headers: response.headers,\n        body: text\n      };\n    });\n  }).then(function (_a) {\n    var status = _a.status,\n      statusText = _a.statusText,\n      headers = _a.headers,\n      body = _a.body;\n    var json;\n    try {\n      json = JSON.parse(body);\n    } catch (e) {\n      // not json, no big deal\n    }\n    if (status < 200 || status >= 300) {\n      return Promise.reject(new HttpError(json && json.message || statusText, status, json));\n    }\n    return Promise.resolve({\n      status: status,\n      headers: headers,\n      body: body,\n      json: json\n    });\n  });\n};\nexport var queryParameters = stringify;\nvar isValidObject = function (value) {\n  if (!value) {\n    return false;\n  }\n  var isArray = Array.isArray(value);\n  var isBuffer = typeof Buffer !== 'undefined' && Buffer.isBuffer(value);\n  var isObject = Object.prototype.toString.call(value) === '[object Object]';\n  var hasKeys = !!Object.keys(value).length;\n  return !isArray && !isBuffer && isObject && hasKeys;\n};\nexport var flattenObject = function (value, path) {\n  var _a;\n  if (path === void 0) {\n    path = [];\n  }\n  if (isValidObject(value)) {\n    return Object.assign.apply(Object, __spreadArray([{}], Object.keys(value).map(function (key) {\n      return flattenObject(value[key], path.concat([key]));\n    }), false));\n  } else {\n    return path.length ? (_a = {}, _a[path.join('.')] = value, _a) : value;\n  }\n};","map":{"version":3,"names":["HttpError","stringify","createHeadersFromOptions","options","requestHeaders","headers","Headers","Accept","hasBody","body","isContentTypeSet","has","isGetMethod","method","isFormData","FormData","shouldSetContentType","set","user","authenticated","token","fetchJson","url","fetch","__assign","then","response","text","status","statusText","_a","json","JSON","parse","e","Promise","reject","message","resolve","queryParameters","isValidObject","value","isArray","Array","isBuffer","Buffer","isObject","Object","prototype","toString","call","hasKeys","keys","length","flattenObject","path","assign","apply","__spreadArray","map","key","concat","join"],"sources":["../../../src/dataProvider/fetch.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,OAAOA,SAAS,MAAM,aAAa;AACnC,SAASC,SAAS,QAAQ,cAAc;AASxC,OAAO,IAAMC,wBAAwB,GAAG,SAAAA,CAACC,OAAgB;EACrD,IAAMC,cAAc,GAAID,OAAO,CAACE,OAAO,IACnC,IAAIC,OAAO,CAAC;IACRC,MAAM,EAAE;GACX,CAAa;EAClB,IAAMC,OAAO,GAAGL,OAAO,IAAIA,OAAO,CAACM,IAAI;EACvC,IAAMC,gBAAgB,GAAGN,cAAc,CAACO,GAAG,CAAC,cAAc,CAAC;EAC3D,IAAMC,WAAW,GAAG,EAACT,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEU,MAAM,KAAI,CAAAV,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEU,MAAM,MAAK,KAAK;EACjE,IAAMC,UAAU,GAAG,CAAAX,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEM,IAAI,aAAYM,QAAQ;EAEpD,IAAMC,oBAAoB,GACtBR,OAAO,IAAI,CAACE,gBAAgB,IAAI,CAACE,WAAW,IAAI,CAACE,UAAU;EAC/D,IAAIE,oBAAoB,EAAE;IACtBZ,cAAc,CAACa,GAAG,CAAC,cAAc,EAAE,kBAAkB,CAAC;;EAG1D,IAAId,OAAO,CAACe,IAAI,IAAIf,OAAO,CAACe,IAAI,CAACC,aAAa,IAAIhB,OAAO,CAACe,IAAI,CAACE,KAAK,EAAE;IAClEhB,cAAc,CAACa,GAAG,CAAC,eAAe,EAAEd,OAAO,CAACe,IAAI,CAACE,KAAK,CAAC;;EAG3D,OAAOhB,cAAc;AACzB,CAAC;AAED;;;;;;;;;;;;;;;;AAgBA,OAAO,IAAMiB,SAAS,GAAG,SAAAA,CAACC,GAAG,EAAEnB,OAAqB;EAArB,IAAAA,OAAA;IAAAA,OAAA,KAAqB;EAAA;EAChD,IAAMC,cAAc,GAAGF,wBAAwB,CAACC,OAAO,CAAC;EAExD,OAAOoB,KAAK,CAACD,GAAG,EAAAE,QAAA,CAAAA,QAAA,KAAOrB,OAAO;IAAEE,OAAO,EAAED;EAAc,GAAG,CACrDqB,IAAI,CAAC,UAAAC,QAAQ;IACV,OAAAA,QAAQ,CAACC,IAAI,EAAE,CAACF,IAAI,CAAC,UAAAE,IAAI;MAAI,OAAC;QAC1BC,MAAM,EAAEF,QAAQ,CAACE,MAAM;QACvBC,UAAU,EAAEH,QAAQ,CAACG,UAAU;QAC/BxB,OAAO,EAAEqB,QAAQ,CAACrB,OAAO;QACzBI,IAAI,EAAEkB;OACT;IAL4B,CAK3B,CAAC;EALH,CAKG,CACN,CACAF,IAAI,CAAC,UAACK,EAAqC;QAAnCF,MAAM,GAAAE,EAAA,CAAAF,MAAA;MAAEC,UAAU,GAAAC,EAAA,CAAAD,UAAA;MAAExB,OAAO,GAAAyB,EAAA,CAAAzB,OAAA;MAAEI,IAAI,GAAAqB,EAAA,CAAArB,IAAA;IACtC,IAAIsB,IAAI;IACR,IAAI;MACAA,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACxB,IAAI,CAAC;KAC1B,CAAC,OAAOyB,CAAC,EAAE;MACR;IAAA;IAEJ,IAAIN,MAAM,GAAG,GAAG,IAAIA,MAAM,IAAI,GAAG,EAAE;MAC/B,OAAOO,OAAO,CAACC,MAAM,CACjB,IAAIpC,SAAS,CACR+B,IAAI,IAAIA,IAAI,CAACM,OAAO,IAAKR,UAAU,EACpCD,MAAM,EACNG,IAAI,CACP,CACJ;;IAEL,OAAOI,OAAO,CAACG,OAAO,CAAC;MAAEV,MAAM,EAAAA,MAAA;MAAEvB,OAAO,EAAAA,OAAA;MAAEI,IAAI,EAAAA,IAAA;MAAEsB,IAAI,EAAAA;IAAA,CAAE,CAAC;EAC3D,CAAC,CAAC;AACV,CAAC;AAED,OAAO,IAAMQ,eAAe,GAAGtC,SAAS;AAExC,IAAMuC,aAAa,GAAG,SAAAA,CAAAC,KAAK;EACvB,IAAI,CAACA,KAAK,EAAE;IACR,OAAO,KAAK;;EAGhB,IAAMC,OAAO,GAAGC,KAAK,CAACD,OAAO,CAACD,KAAK,CAAC;EACpC,IAAMG,QAAQ,GAAG,OAAOC,MAAM,KAAK,WAAW,IAAIA,MAAM,CAACD,QAAQ,CAACH,KAAK,CAAC;EACxE,IAAMK,QAAQ,GACVC,MAAM,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACT,KAAK,CAAC,KAAK,iBAAiB;EAC/D,IAAMU,OAAO,GAAG,CAAC,CAACJ,MAAM,CAACK,IAAI,CAACX,KAAK,CAAC,CAACY,MAAM;EAE3C,OAAO,CAACX,OAAO,IAAI,CAACE,QAAQ,IAAIE,QAAQ,IAAIK,OAAO;AACvD,CAAC;AAED,OAAO,IAAMG,aAAa,GAAG,SAAAA,CAACb,KAAU,EAAEc,IAAmB;;EAAnB,IAAAA,IAAA;IAAAA,IAAA,KAAmB;EAAA;EACzD,IAAIf,aAAa,CAACC,KAAK,CAAC,EAAE;IACtB,OAAOM,MAAM,CAACS,MAAM,CAAAC,KAAA,CAAbV,MAAM,EAAAW,aAAA,EACT,EAAE,GACCX,MAAM,CAACK,IAAI,CAACX,KAAK,CAAC,CAACkB,GAAG,CAAC,UAAAC,GAAG;MACzB,OAAAN,aAAa,CAACb,KAAK,CAACmB,GAAG,CAAC,EAAEL,IAAI,CAACM,MAAM,CAAC,CAACD,GAAG,CAAC,CAAC,CAAC;IAA7C,CAA6C,CAChD;GAER,MAAM;IACH,OAAOL,IAAI,CAACF,MAAM,IAAEvB,EAAA,OAAGA,EAAA,CAACyB,IAAI,CAACO,IAAI,CAAC,GAAG,CAAC,IAAGrB,KAAK,EAAAX,EAAA,IAAKW,KAAK;;AAEhE,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}