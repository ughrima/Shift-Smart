{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { isValidElement, useEffect, useMemo } from 'react';\nimport { useAuthenticated } from '../../auth';\nimport { useTranslate } from '../../i18n';\nimport { useNotify } from '../../notification';\nimport { useInfiniteGetList } from '../../dataProvider';\nimport { defaultExporter } from '../../export';\nimport { useResourceContext, useGetResourceLabel } from '../../core';\nimport { useRecordSelection } from './useRecordSelection';\nimport { useListParams } from './useListParams';\n/**\n * Prepare data for the InfiniteList view\n *\n * @param {Object} props The props passed to the InfiniteList component.\n *\n * @return {Object} controllerProps Fetched and computed data for the List view\n *\n * @example\n *\n * import { useInfiniteListController } from 'react-admin';\n * import ListView from './ListView';\n *\n * const MyList = props => {\n *     const controllerProps = useInfiniteListController(props);\n *     return <ListView {...controllerProps} {...props} />;\n * }\n */\nexport var useInfiniteListController = function (props) {\n  if (props === void 0) {\n    props = {};\n  }\n  var _a = props.debounce,\n    debounce = _a === void 0 ? 500 : _a,\n    disableAuthentication = props.disableAuthentication,\n    disableSyncWithLocation = props.disableSyncWithLocation,\n    _b = props.exporter,\n    exporter = _b === void 0 ? defaultExporter : _b,\n    filter = props.filter,\n    filterDefaultValues = props.filterDefaultValues,\n    _c = props.perPage,\n    perPage = _c === void 0 ? 10 : _c,\n    _d = props.queryOptions,\n    queryOptions = _d === void 0 ? {} : _d,\n    sort = props.sort,\n    storeKey = props.storeKey;\n  useAuthenticated({\n    enabled: !disableAuthentication\n  });\n  var resource = useResourceContext(props);\n  var meta = queryOptions.meta,\n    otherQueryOptions = __rest(queryOptions, [\"meta\"]);\n  if (!resource) {\n    throw new Error(\"<InfiniteList> was called outside of a ResourceContext and without a resource prop. You must set the resource prop.\");\n  }\n  if (filter && isValidElement(filter)) {\n    throw new Error('<InfiniteList> received a React element as `filter` props. If you intended to set the list filter elements, use the `filters` (with an s) prop instead. The `filter` prop is internal and should not be set by the developer.');\n  }\n  var translate = useTranslate();\n  var notify = useNotify();\n  var _e = useListParams({\n      debounce: debounce,\n      disableSyncWithLocation: disableSyncWithLocation,\n      filterDefaultValues: filterDefaultValues,\n      perPage: perPage,\n      resource: resource,\n      sort: sort,\n      storeKey: storeKey\n    }),\n    query = _e[0],\n    queryModifiers = _e[1];\n  var _f = useRecordSelection(resource),\n    selectedIds = _f[0],\n    selectionModifiers = _f[1];\n  var _g = useInfiniteGetList(resource, {\n      pagination: {\n        page: query.page,\n        perPage: query.perPage\n      },\n      sort: {\n        field: query.sort,\n        order: query.order\n      },\n      filter: __assign(__assign({}, query.filter), filter),\n      meta: meta\n    }, __assign({\n      keepPreviousData: true,\n      retry: false,\n      onError: function (error) {\n        return notify((error === null || error === void 0 ? void 0 : error.message) || 'ra.notification.http_error', {\n          type: 'error',\n          messageArgs: {\n            _: error === null || error === void 0 ? void 0 : error.message\n          }\n        });\n      }\n    }, otherQueryOptions)),\n    data = _g.data,\n    total = _g.total,\n    error = _g.error,\n    isLoading = _g.isLoading,\n    isFetching = _g.isFetching,\n    hasNextPage = _g.hasNextPage,\n    hasPreviousPage = _g.hasPreviousPage,\n    fetchNextPage = _g.fetchNextPage,\n    isFetchingNextPage = _g.isFetchingNextPage,\n    fetchPreviousPage = _g.fetchPreviousPage,\n    isFetchingPreviousPage = _g.isFetchingPreviousPage,\n    refetch = _g.refetch;\n  // change page if there is no data\n  useEffect(function () {\n    if (query.page <= 0 || !isFetching && query.page > 1 && (data == null || (data === null || data === void 0 ? void 0 : data.pages.length) === 0)) {\n      // Query for a page that doesn't exist, set page to 1\n      queryModifiers.setPage(1);\n      return;\n    }\n    if (total == null) {\n      return;\n    }\n    var totalPages = Math.ceil(total / query.perPage) || 1;\n    if (!isFetching && query.page > totalPages) {\n      // Query for a page out of bounds, set page to the last existing page\n      // It occurs when deleting the last element of the last page\n      queryModifiers.setPage(totalPages);\n    }\n  }, [isFetching, query.page, query.perPage, data, queryModifiers, total]);\n  var currentSort = useMemo(function () {\n    return {\n      field: query.sort,\n      order: query.order\n    };\n  }, [query.sort, query.order]);\n  var getResourceLabel = useGetResourceLabel();\n  var defaultTitle = translate('ra.page.list', {\n    name: getResourceLabel(resource, 2)\n  });\n  var unwrappedData = useMemo(function () {\n    var _a;\n    return (_a = data === null || data === void 0 ? void 0 : data.pages) === null || _a === void 0 ? void 0 : _a.reduce(function (acc, page) {\n      return __spreadArray(__spreadArray([], acc, true), page.data, true);\n    }, []);\n  }, [data]);\n  return {\n    sort: currentSort,\n    data: unwrappedData,\n    defaultTitle: defaultTitle,\n    displayedFilters: query.displayedFilters,\n    error: error,\n    exporter: exporter,\n    filter: filter,\n    filterValues: query.filterValues,\n    hideFilter: queryModifiers.hideFilter,\n    isFetching: isFetching,\n    isLoading: isLoading,\n    onSelect: selectionModifiers.select,\n    onToggleItem: selectionModifiers.toggle,\n    onUnselectItems: selectionModifiers.clearSelection,\n    page: query.page,\n    perPage: query.perPage,\n    refetch: refetch,\n    resource: resource,\n    selectedIds: selectedIds,\n    setFilters: queryModifiers.setFilters,\n    setPage: queryModifiers.setPage,\n    setPerPage: queryModifiers.setPerPage,\n    setSort: queryModifiers.setSort,\n    showFilter: queryModifiers.showFilter,\n    total: total,\n    hasNextPage: hasNextPage,\n    hasPreviousPage: hasPreviousPage,\n    fetchNextPage: fetchNextPage,\n    isFetchingNextPage: isFetchingNextPage,\n    fetchPreviousPage: fetchPreviousPage,\n    isFetchingPreviousPage: isFetchingPreviousPage\n  };\n};","map":{"version":3,"names":["isValidElement","useEffect","useMemo","useAuthenticated","useTranslate","useNotify","useInfiniteGetList","defaultExporter","useResourceContext","useGetResourceLabel","useRecordSelection","useListParams","useInfiniteListController","props","_a","debounce","disableAuthentication","disableSyncWithLocation","_b","exporter","filter","filterDefaultValues","_c","perPage","_d","queryOptions","sort","storeKey","enabled","resource","meta","otherQueryOptions","__rest","Error","translate","notify","_e","query","queryModifiers","_f","selectedIds","selectionModifiers","_g","pagination","page","field","order","__assign","keepPreviousData","retry","onError","error","message","type","messageArgs","_","data","total","isLoading","isFetching","hasNextPage","hasPreviousPage","fetchNextPage","isFetchingNextPage","fetchPreviousPage","isFetchingPreviousPage","refetch","pages","length","setPage","totalPages","Math","ceil","currentSort","getResourceLabel","defaultTitle","name","unwrappedData","reduce","acc","__spreadArray","displayedFilters","filterValues","hideFilter","onSelect","select","onToggleItem","toggle","onUnselectItems","clearSelection","setFilters","setPerPage","setSort","showFilter"],"sources":["../../../../src/controller/list/useInfiniteListController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}