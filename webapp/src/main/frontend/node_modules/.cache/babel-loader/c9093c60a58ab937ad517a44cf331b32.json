{"ast":null,"code":"import { useCallback } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { useNotificationContext } from '../notification';\nimport { useBasename } from '../routing';\nimport useAuthProvider, { defaultAuthParams } from './useAuthProvider';\nimport { removeDoubleSlashes } from '../routing/useCreatePath';\n/**\n * Get a callback for calling the authProvider.login() method\n * and redirect to the previous authenticated page (or the home page) on success.\n *\n * @see useAuthProvider\n *\n * @returns {Function} login callback\n *\n * @example\n *\n * import { useLogin } from 'react-admin';\n *\n * const LoginButton = () => {\n *     const [loading, setLoading] = useState(false);\n *     const login = useLogin();\n *     const handleClick = {\n *         setLoading(true);\n *         login({ username: 'john', password: 'p@ssw0rd' }, '/posts')\n *             .then(() => setLoading(false));\n *     }\n *     return <button onClick={handleClick}>Login</button>;\n * }\n */\nvar useLogin = function () {\n  var authProvider = useAuthProvider();\n  var location = useLocation();\n  var locationState = location.state;\n  var navigate = useNavigate();\n  var basename = useBasename();\n  var resetNotifications = useNotificationContext().resetNotifications;\n  var nextPathName = locationState && locationState.nextPathname;\n  var nextSearch = locationState && locationState.nextSearch;\n  var afterLoginUrl = removeDoubleSlashes(\"\".concat(basename, \"/\").concat(defaultAuthParams.afterLoginUrl));\n  var login = useCallback(function (params, pathName) {\n    if (params === void 0) {\n      params = {};\n    }\n    return authProvider.login(params).then(function (ret) {\n      resetNotifications();\n      if (ret && ret.hasOwnProperty('redirectTo')) {\n        if (ret) {\n          navigate(ret.redirectTo);\n        }\n      } else {\n        var redirectUrl = pathName ? pathName : nextPathName + nextSearch || afterLoginUrl;\n        navigate(redirectUrl);\n      }\n      return ret;\n    });\n  }, [authProvider, navigate, nextPathName, nextSearch, resetNotifications, afterLoginUrl]);\n  var loginWithoutProvider = useCallback(function (_, __) {\n    resetNotifications();\n    navigate(afterLoginUrl);\n    return Promise.resolve();\n  }, [navigate, resetNotifications, afterLoginUrl]);\n  return authProvider ? login : loginWithoutProvider;\n};\nexport default useLogin;","map":{"version":3,"names":["useCallback","useLocation","useNavigate","useNotificationContext","useBasename","useAuthProvider","defaultAuthParams","removeDoubleSlashes","useLogin","authProvider","location","locationState","state","navigate","basename","resetNotifications","nextPathName","nextPathname","nextSearch","afterLoginUrl","concat","login","params","pathName","then","ret","hasOwnProperty","redirectTo","redirectUrl","loginWithoutProvider","_","__","Promise","resolve"],"sources":["../../../src/auth/useLogin.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,WAAW,EAAEC,WAAW,QAAQ,kBAAkB;AAE3D,SAASC,sBAAsB,QAAQ,iBAAiB;AACxD,SAASC,WAAW,QAAQ,YAAY;AACxC,OAAOC,eAAe,IAAIC,iBAAiB,QAAQ,mBAAmB;AACtE,SAASC,mBAAmB,QAAQ,0BAA0B;AAE9D;;;;;;;;;;;;;;;;;;;;;;;AAuBA,IAAMC,QAAQ,GAAG,SAAAA,CAAA;EACb,IAAMC,YAAY,GAAGJ,eAAe,EAAE;EACtC,IAAMK,QAAQ,GAAGT,WAAW,EAAE;EAC9B,IAAMU,aAAa,GAAGD,QAAQ,CAACE,KAAY;EAC3C,IAAMC,QAAQ,GAAGX,WAAW,EAAE;EAC9B,IAAMY,QAAQ,GAAGV,WAAW,EAAE;EACtB,IAAAW,kBAAkB,GAAKZ,sBAAsB,EAAE,CAAAY,kBAA7B;EAC1B,IAAMC,YAAY,GAAGL,aAAa,IAAIA,aAAa,CAACM,YAAY;EAChE,IAAMC,UAAU,GAAGP,aAAa,IAAIA,aAAa,CAACO,UAAU;EAC5D,IAAMC,aAAa,GAAGZ,mBAAmB,CACrC,GAAAa,MAAA,CAAGN,QAAQ,OAAAM,MAAA,CAAId,iBAAiB,CAACa,aAAa,CAAE,CACnD;EAED,IAAME,KAAK,GAAGrB,WAAW,CACrB,UAACsB,MAAgB,EAAEC,QAAQ;IAA1B,IAAAD,MAAA;MAAAA,MAAA,KAAgB;IAAA;IACb,OAAAb,YAAY,CAACY,KAAK,CAACC,MAAM,CAAC,CAACE,IAAI,CAAC,UAAAC,GAAG;MAC/BV,kBAAkB,EAAE;MACpB,IAAIU,GAAG,IAAIA,GAAG,CAACC,cAAc,CAAC,YAAY,CAAC,EAAE;QACzC,IAAID,GAAG,EAAE;UACLZ,QAAQ,CAACY,GAAG,CAACE,UAAU,CAAC;;OAE/B,MAAM;QACH,IAAMC,WAAW,GAAGL,QAAQ,GACtBA,QAAQ,GACRP,YAAY,GAAGE,UAAU,IAAIC,aAAa;QAChDN,QAAQ,CAACe,WAAW,CAAC;;MAEzB,OAAOH,GAAG;IACd,CAAC,CAAC;EAbF,CAaE,EACN,CACIhB,YAAY,EACZI,QAAQ,EACRG,YAAY,EACZE,UAAU,EACVH,kBAAkB,EAClBI,aAAa,CAChB,CACJ;EAED,IAAMU,oBAAoB,GAAG7B,WAAW,CACpC,UAAC8B,CAAC,EAAEC,EAAE;IACFhB,kBAAkB,EAAE;IACpBF,QAAQ,CAACM,aAAa,CAAC;IACvB,OAAOa,OAAO,CAACC,OAAO,EAAE;EAC5B,CAAC,EACD,CAACpB,QAAQ,EAAEE,kBAAkB,EAAEI,aAAa,CAAC,CAChD;EAED,OAAOV,YAAY,GAAGY,KAAK,GAAGQ,oBAAoB;AACtD,CAAC;AAYD,eAAerB,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module"}