{"ast":null,"code":"import { useContext, useEffect, useRef } from 'react';\nimport { useFormState } from 'react-hook-form';\nimport { UNSAFE_NavigationContext, useLocation } from 'react-router-dom';\nimport { useTranslate } from '../i18n';\n/**\n * Display a confirmation dialog if the form has unsaved changes.\n * - If the user confirms, the navigation continues and the changes are lost.\n * - If the user cancels, the navigation is cancelled and the changes are kept.\n */\nexport var useWarnWhenUnsavedChanges = function (enable, formRootPathname, control) {\n  // react-router v6 does not yet provide a way to block navigation\n  // This is planned for a future release\n  // See https://github.com/remix-run/react-router/issues/8139\n  var navigator = useContext(UNSAFE_NavigationContext).navigator;\n  var location = useLocation();\n  var translate = useTranslate();\n  var _a = useFormState(control ? {\n      control: control\n    } : undefined),\n    isSubmitSuccessful = _a.isSubmitSuccessful,\n    isSubmitting = _a.isSubmitting,\n    dirtyFields = _a.dirtyFields;\n  var isDirty = Object.keys(dirtyFields).length > 0;\n  var initialLocation = useRef(formRootPathname || location.pathname);\n  useEffect(function () {\n    if (!enable || !isDirty) return;\n    if (!navigator.block) {\n      if (process.env.NODE_ENV !== 'production') {\n        console.warn('warnWhenUnsavedChanged is not compatible with react-router >= 6.4. If you need this feature, please downgrade react-router to 6.3.0');\n      }\n      return;\n    }\n    var unblock = navigator.block(function (tx) {\n      var newLocationIsInsideCurrentLocation = tx.location.pathname.startsWith(initialLocation.current);\n      var newLocationIsShowView = tx.location.pathname.startsWith(\"\".concat(initialLocation.current, \"/show\"));\n      var newLocationIsInsideForm = newLocationIsInsideCurrentLocation && !newLocationIsShowView;\n      if (!isSubmitting && (newLocationIsInsideForm || isSubmitSuccessful || window.confirm(translate('ra.message.unsaved_changes')))) {\n        unblock();\n        tx.retry();\n      } else {\n        if (isSubmitting) {\n          // Retry the transition (possibly several times) until the form is no longer submitting.\n          // The value of 100ms is arbitrary, it allows to give some time between retries.\n          setTimeout(function () {\n            tx.retry();\n          }, 100);\n        }\n      }\n    });\n    return unblock;\n  }, [enable, location, navigator, isDirty, isSubmitting, isSubmitSuccessful, translate]);\n};","map":{"version":3,"names":["useContext","useEffect","useRef","useFormState","UNSAFE_NavigationContext","useLocation","useTranslate","useWarnWhenUnsavedChanges","enable","formRootPathname","control","navigator","location","translate","_a","undefined","isSubmitSuccessful","isSubmitting","dirtyFields","isDirty","Object","keys","length","initialLocation","pathname","block","process","env","NODE_ENV","console","warn","unblock","tx","newLocationIsInsideCurrentLocation","startsWith","current","newLocationIsShowView","concat","newLocationIsInsideForm","window","confirm","retry","setTimeout"],"sources":["../../../src/form/useWarnWhenUnsavedChanges.tsx"],"sourcesContent":[null],"mappings":"AAAA,SAASA,UAAU,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AACrD,SAASC,YAAY,QAAiB,iBAAiB;AACvD,SAASC,wBAAwB,EAAEC,WAAW,QAAQ,kBAAkB;AAExE,SAASC,YAAY,QAAQ,SAAS;AAEtC;;;;;AAKA,OAAO,IAAMC,yBAAyB,GAAG,SAAAA,CACrCC,MAAe,EACfC,gBAAyB,EACzBC,OAAiB;EAEjB;EACA;EACA;EACA,IAAMC,SAAS,GAAGX,UAAU,CAACI,wBAAwB,CAAC,CAACO,SAAoB;EAC3E,IAAMC,QAAQ,GAAGP,WAAW,EAAE;EAC9B,IAAMQ,SAAS,GAAGP,YAAY,EAAE;EAC1B,IAAAQ,EAAA,GAAoDX,YAAY,CAClEO,OAAO,GAAG;MAAEA,OAAO,EAAAA;IAAA,CAAE,GAAGK,SAAS,CACpC;IAFOC,kBAAkB,GAAAF,EAAA,CAAAE,kBAAA;IAAEC,YAAY,GAAAH,EAAA,CAAAG,YAAA;IAAEC,WAAW,GAAAJ,EAAA,CAAAI,WAEpD;EACD,IAAMC,OAAO,GAAGC,MAAM,CAACC,IAAI,CAACH,WAAW,CAAC,CAACI,MAAM,GAAG,CAAC;EACnD,IAAMC,eAAe,GAAGrB,MAAM,CAACO,gBAAgB,IAAIG,QAAQ,CAACY,QAAQ,CAAC;EAErEvB,SAAS,CAAC;IACN,IAAI,CAACO,MAAM,IAAI,CAACW,OAAO,EAAE;IACzB,IAAI,CAACR,SAAS,CAACc,KAAK,EAAE;MAClB,IAAIC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,EAAE;QACvCC,OAAO,CAACC,IAAI,CACR,qIAAqI,CACxI;;MAEL;;IAGJ,IAAIC,OAAO,GAAGpB,SAAS,CAACc,KAAK,CAAC,UAACO,EAAc;MACzC,IAAMC,kCAAkC,GAAGD,EAAE,CAACpB,QAAQ,CAACY,QAAQ,CAACU,UAAU,CACtEX,eAAe,CAACY,OAAO,CAC1B;MACD,IAAMC,qBAAqB,GAAGJ,EAAE,CAACpB,QAAQ,CAACY,QAAQ,CAACU,UAAU,CACzD,GAAAG,MAAA,CAAGd,eAAe,CAACY,OAAO,UAAO,CACpC;MACD,IAAMG,uBAAuB,GACzBL,kCAAkC,IAAI,CAACG,qBAAqB;MAEhE,IACI,CAACnB,YAAY,KACZqB,uBAAuB,IACpBtB,kBAAkB,IAClBuB,MAAM,CAACC,OAAO,CAAC3B,SAAS,CAAC,4BAA4B,CAAC,CAAC,CAAC,EAC9D;QACEkB,OAAO,EAAE;QACTC,EAAE,CAACS,KAAK,EAAE;OACb,MAAM;QACH,IAAIxB,YAAY,EAAE;UACd;UACA;UACAyB,UAAU,CAAC;YACPV,EAAE,CAACS,KAAK,EAAE;UACd,CAAC,EAAE,GAAG,CAAC;;;IAGnB,CAAC,CAAC;IAEF,OAAOV,OAAO;EAClB,CAAC,EAAE,CACCvB,MAAM,EACNI,QAAQ,EACRD,SAAS,EACTQ,OAAO,EACPF,YAAY,EACZD,kBAAkB,EAClBH,SAAS,CACZ,CAAC;AACN,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}