{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useCallback, useMemo, useState, useRef, useEffect } from 'react';\nimport lodashDebounce from 'lodash/debounce';\nimport removeEmpty from '../../util/removeEmpty';\nimport { queryReducer, HIDE_FILTER, SET_FILTER, SET_PAGE, SET_PER_PAGE, SET_SORT, SHOW_FILTER, SORT_ASC } from '../list';\n/**\n * Get the reference inputs parameters (page, sort, filters) and modifiers.\n *\n * @returns {Array} A tuple [parameters, modifiers].\n * Destructure as [\n *    { page, perPage, sort, order, filter, filterValues, displayedFilters, requestSignature },\n *    { setFilters, hideFilter, showFilter, setPage, setPerPage, setSort }\n * ]\n *\n * @example\n *\n * const [referenceParams, referenceParamsActions] = useReferenceParams({\n *      resource: 'posts',\n *      filterDefaultValues: {\n *          published: true\n *      },\n *      sort: {\n *          field: 'published_at',\n *          order: 'DESC'\n *      },\n *      perPage: 25\n * });\n *\n * const {\n *      page,\n *      perPage,\n *      sort,\n *      order,\n *      filter,\n *      filterValues,\n *      displayedFilters,\n *      requestSignature\n * } = referenceParams;\n *\n * const {\n *      setFilters,\n *      hideFilter,\n *      showFilter,\n *      setPage,\n *      setPerPage,\n *      setSort,\n * } = referenceParamsActions;\n */\nexport var useReferenceParams = function (_a) {\n  var resource = _a.resource,\n    filter = _a.filter,\n    _b = _a.sort,\n    sort = _b === void 0 ? defaultSort : _b,\n    _c = _a.page,\n    page = _c === void 0 ? 1 : _c,\n    _d = _a.perPage,\n    perPage = _d === void 0 ? 10 : _d,\n    _e = _a.debounce,\n    debounce = _e === void 0 ? 500 : _e;\n  var _f = useState(defaultParams),\n    params = _f[0],\n    setParams = _f[1];\n  var tempParams = useRef();\n  var requestSignature = [resource, JSON.stringify(params), JSON.stringify(filter), JSON.stringify(sort), page, perPage];\n  var query = useMemo(function () {\n    return getQuery({\n      params: params,\n      filterDefaultValues: filter,\n      sort: sort,\n      page: page,\n      perPage: perPage\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var changeParams = useCallback(function (action) {\n    if (!tempParams.current) {\n      // no other changeParams action dispatched this tick\n      tempParams.current = queryReducer(query, action);\n      // schedule side effects for next tick\n      setTimeout(function () {\n        setParams(tempParams.current);\n        tempParams.current = undefined;\n      }, 0);\n    } else {\n      // side effects already scheduled, just change the params\n      tempParams.current = queryReducer(tempParams.current, action);\n    }\n  }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n  var setSort = useCallback(function (sort) {\n    return changeParams({\n      type: SET_SORT,\n      payload: sort\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var setPage = useCallback(function (newPage) {\n    return changeParams({\n      type: SET_PAGE,\n      payload: newPage\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var setPerPage = useCallback(function (newPerPage) {\n    return changeParams({\n      type: SET_PER_PAGE,\n      payload: newPerPage\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var filterValues = query.filter || emptyObject;\n  var displayedFilterValues = query.displayedFilters || emptyObject;\n  var debouncedSetFilters = useRef(lodashDebounce(function (filter, displayedFilters) {\n    changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: removeEmpty(filter),\n        displayedFilters: displayedFilters\n      }\n    });\n  }, debounce));\n  useEffect(function () {\n    return function () {\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      debouncedSetFilters.current.cancel();\n    };\n  }, []);\n  var setFilters = useCallback(function (filter, displayedFilters, debounce) {\n    if (debounce === void 0) {\n      debounce = true;\n    }\n    debounce ? debouncedSetFilters.current(filter, displayedFilters) : changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: removeEmpty(filter),\n        displayedFilters: displayedFilters\n      }\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var hideFilter = useCallback(function (filterName) {\n    changeParams({\n      type: HIDE_FILTER,\n      payload: filterName\n    });\n  }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n  var showFilter = useCallback(function (filterName, defaultValue) {\n    changeParams({\n      type: SHOW_FILTER,\n      payload: {\n        filterName: filterName,\n        defaultValue: defaultValue\n      }\n    });\n  }, requestSignature); // eslint-disable-line react-hooks/exhaustive-deps\n  return [__assign({\n    displayedFilters: displayedFilterValues,\n    filterValues: filterValues,\n    requestSignature: requestSignature\n  }, query), {\n    changeParams: changeParams,\n    setPage: setPage,\n    setPerPage: setPerPage,\n    setSort: setSort,\n    setFilters: setFilters,\n    hideFilter: hideFilter,\n    showFilter: showFilter\n  }];\n};\nexport var validQueryParams = ['page', 'perPage', 'sort', 'order', 'filter', 'displayedFilters'];\n/**\n * Merge list params from 2 different sources:\n *   - the params stored in the local state\n *   - the props passed to the List component (including the filter defaultValues)\n */\nexport var getQuery = function (_a) {\n  var params = _a.params,\n    filterDefaultValues = _a.filterDefaultValues,\n    sort = _a.sort,\n    page = _a.page,\n    perPage = _a.perPage;\n  var query = hasCustomParams(params) ? __assign({}, params) : {\n    filter: filterDefaultValues || {}\n  };\n  if (!query.sort) {\n    query.sort = sort.field;\n    query.order = sort.order;\n  }\n  if (query.page == null) {\n    query.page = page;\n  }\n  if (query.perPage == null) {\n    query.perPage = perPage;\n  }\n  if (query.page == null) {\n    query.page = 1;\n  }\n  return __assign(__assign({}, query), {\n    page: getNumberOrDefault(query.page, 1),\n    perPage: getNumberOrDefault(query.perPage, 10)\n  });\n};\n/**\n * Check if user has already set custom sort, page, or filters for this list\n *\n * User params come from the Redux store as the params props. By default,\n * this object is:\n *\n * { filter: {}, order: null, page: 1, perPage: null, sort: null }\n *\n * To check if the user has custom params, we must compare the params\n * to these initial values.\n *\n * @param {Object} params\n */\nexport var hasCustomParams = function (params) {\n  return params && params.filter && (Object.keys(params.filter).length > 0 || params.order != null || params.page !== 1 || params.perPage != null || params.sort != null);\n};\nexport var getNumberOrDefault = function (possibleNumber, defaultValue) {\n  var parsedNumber = typeof possibleNumber === 'string' ? parseInt(possibleNumber, 10) : possibleNumber;\n  return isNaN(parsedNumber) ? defaultValue : parsedNumber;\n};\nvar emptyObject = {};\nvar defaultSort = {\n  field: 'id',\n  order: SORT_ASC\n};\nvar defaultParams = {};","map":{"version":3,"names":["useCallback","useMemo","useState","useRef","useEffect","lodashDebounce","removeEmpty","queryReducer","HIDE_FILTER","SET_FILTER","SET_PAGE","SET_PER_PAGE","SET_SORT","SHOW_FILTER","SORT_ASC","useReferenceParams","_a","resource","filter","_b","sort","defaultSort","_c","page","_d","perPage","_e","debounce","_f","defaultParams","params","setParams","tempParams","requestSignature","JSON","stringify","query","getQuery","filterDefaultValues","changeParams","action","current","setTimeout","undefined","setSort","type","payload","setPage","newPage","setPerPage","newPerPage","filterValues","emptyObject","displayedFilterValues","displayedFilters","debouncedSetFilters","cancel","setFilters","hideFilter","filterName","showFilter","defaultValue","validQueryParams","hasCustomParams","__assign","field","order","getNumberOrDefault","Object","keys","length","possibleNumber","parsedNumber","parseInt","isNaN"],"sources":["../../../../src/controller/input/useReferenceParams.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}